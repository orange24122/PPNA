<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¤¾äº¤ç±»APPéšç§æ”¿ç­–åˆè§„æ£€æµ‹ç³»ç»Ÿ</title>
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* é…ç½® Inter å­—ä½“å’Œæ·±è‰²ä¸»é¢˜ */
        :root {
            font-family: 'Inter', sans-serif;
        }

        /* ä¼˜åŒ–æ»šåŠ¨æ¡æ ·å¼ */
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        
        /* å¢å¼ºçš„æ·±è‰²ä¸»é¢˜é¢œè‰² */
        .bg-card { background-color: #1f2937; }
        .bg-sidebar { background-color: #111827; }
        .border-primary { border-color: #4b5563; }
        .text-primary { color: #d1d5db; }

        /* è¿›åº¦æ¡æ ·å¼ */
        .progress-step {
            transition: all 0.3s ease;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
        }
        .progress-step.active {
            background-color: #3b82f6;
            color: white;
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.5);
            border-color: #3b82f6;
        }
        .progress-line {
            height: 4px;
            background-color: #4b5563;
        }
        .progress-line.active {
            background: linear-gradient(to right, #3b82f6, #6366f1);
            transition: width 1s ease;
        }

        /* åŠ¨ç”»æ•ˆæœ */
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ä¾§è¾¹å¯¼èˆªæ æ ·å¼ */
        .nav-item {
            transition: all 0.2s;
            border-radius: 0.5rem;
        }
        .nav-item:hover {
            background-color: #374151;
            transform: translateX(2px);
        }
        .nav-item.active {
            border-left: 4px solid #3b82f6;
            background-color: #1f2937;
            font-weight: 600;
            color: #3b82f6;
        }

        /* è¿è§„é«˜äº®æ ·å¼ (Report Detail Page) */
        .violation-highlight {
            background-color: rgba(239, 68, 68, 0.2);
            border-bottom: 2px solid #ef4444;
            padding: 1px 3px;
            border-radius: 4px;
            cursor: pointer; 
            transition: all 0.2s;
            display: inline-block; /* ç¡®ä¿é«˜äº®èƒ½è¢« filterRisksByType éšè— */
        }
        .violation-highlight:hover {
            background-color: rgba(239, 68, 68, 0.4);
        }
        .violation-highlight.selected {
            background-color: #fca5a5; /* é€‰ä¸­æ—¶çš„æ›´äº®é¢œè‰² */
            color: #1f2937;
            font-weight: bold;
            box-shadow: 0 0 8px rgba(252, 165, 165, 0.7);
        }

        /* é£é™©å¡ç‰‡æ ·å¼ */
        .risk-summary-card {
            transition: all 0.3s;
            border-left: 5px solid;
        }
        .risk-summary-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        .risk-summary-card.active {
            transform: scale(1.02);
            border: 2px solid #3b82f6; /* é€‰ä¸­æ—¶è¾¹æ¡†æ›´æ˜æ˜¾ */
            box-shadow: 0 4px 20px rgba(59, 130, 246, 0.4);
        }

        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 768px) {
            #sidebar {
                position: fixed;
                left: 0;
                top: 0;
                bottom: 0;
                z-index: 40;
                transform: translateX(-100%);
                transition: transform 0.3s ease-in-out;
            }
            #sidebar.open {
                transform: translateX(0);
            }
        }
    </style>
</head>

<body class="bg-gray-900 text-gray-100 min-h-screen flex">

    <!-- æ¨¡æ‹Ÿ API å¯†é’¥å’Œæ•°æ® -->
    <script>
        const apiKey = ""; 
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
    </script>
    
    <!-- ä¾§è¾¹å¯¼èˆªæ  (Sidebar) -->
    <nav id="sidebar" class="bg-sidebar w-64 flex-shrink-0 p-4 space-y-4 shadow-2xl z-40 md:static md:translate-x-0">
        <div class="text-2xl font-bold text-blue-400 border-b border-primary pb-3 mb-4 flex justify-between items-center">
            <span>åˆè§„æ£€æµ‹ç³»ç»Ÿ</span>
            <button id="closeSidebar" class="md:hidden text-gray-400 hover:text-white transition">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
        </div>
        <div class="space-y-2">
            <!-- æ ¸å¿ƒåŠŸèƒ½ -->
            <button class="nav-item w-full text-left p-3 flex items-center space-x-3 text-gray-300 active" data-page="upload">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>
                <span>æ”¿ç­–ä¸Šä¼ ä¸æ£€æµ‹</span>
            </button>
            <button class="nav-item w-full text-left p-3 flex items-center space-x-3 text-gray-300" data-page="report-list">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 002 2h2m-2 4h.01m-4 0h.01m4 0h.01m-4 4h.01m4 0h.01"></path></svg>
                <span>åˆè§„æŠ¥å‘Šåˆ—è¡¨</span>
            </button>

            <!-- ç®¡ç†å‘˜ä¸“å±/è¾…åŠ©åŠŸèƒ½ -->
            <div class="border-t border-primary pt-4 mt-4">
                <p class="text-xs uppercase text-gray-500 mb-2">ç®¡ç†ä¸è¾…åŠ©</p>
                <button class="nav-item w-full text-left p-3 flex items-center space-x-3 text-gray-300 opacity-50" data-page="admin" disabled>
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                    <span>æ³•è§„/æ¡ˆä¾‹åº“ (Admin)</span>
                </button>
                <button class="nav-item w-full text-left p-3 flex items-center space-x-3 text-gray-300" data-page="logs">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-4 4V3m-4 12h8m-8 4h8m-9-4v4a2 2 0 002 2h8a2 2 0 002-2v-4"></path></svg>
                    <span>æ“ä½œæ—¥å¿—</span>
                </button>
            </div>
        </div>
        
        <!-- ç™»å½•/ç™»å‡ºæŒ‰é’® -->
        <div class="absolute bottom-4 left-4 right-4 border-t border-primary pt-4">
            <button class="nav-item w-full text-left p-3 flex items-center space-x-3 text-red-400" data-page="login">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1m-4 0v-1a4 4 0 014-4h4a4 4 0 014 4v1m-6-1v1"></path></svg>
                <span id="authStatus">é€€å‡º/ç™»å½•</span>
            </button>
        </div>
    </nav>
    
    <!-- ç§»åŠ¨ç«¯ä¾§è¾¹æ é®ç½© -->
    <div id="sidebarOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-30 hidden md:hidden"></div>
    
    <!-- ä¸»å†…å®¹åŒº -->
    <div class="flex-grow flex flex-col">
        <!-- ç§»åŠ¨ç«¯æ±‰å ¡èœå•å’Œæ ‡é¢˜ -->
        <header class="md:hidden bg-sidebar p-4 shadow-lg flex justify-between items-center sticky top-0 z-20">
             <button id="openSidebar" class="text-gray-200 hover:text-blue-400">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
            </button>
            <h1 class="text-xl font-bold text-blue-400">åˆè§„ç³»ç»Ÿ</h1>
            <div class="w-6"></div> <!-- Placeholder -->
        </header>

        <main id="mainContent" class="p-6 sm:p-10 flex-grow hide-scrollbar overflow-y-auto">
            <!-- å†…å®¹å°†åœ¨æ­¤å¤„åŠ¨æ€åŠ è½½ -->
        </main>
    </div>

    <!-- æ¨¡æ€æ¡† (ç”¨äºç™»å½•æŒ‡å¼•ã€åˆ†å—æ ¡éªŒæç¤ºç­‰) -->
    <div id="modal" class="fixed inset-0 bg-black bg-opacity-70 z-50 items-center justify-center hidden">
        <div id="modalBody" class="bg-card p-8 rounded-xl shadow-2xl w-full max-w-lg transition-all duration-300">
            <!-- Modal Content -->
        </div>
    </div>


    <script>
        let currentPage = 'login';
        let isUserLoggedIn = false;
        let isUserAdmin = false; 
        let detectionStatus = 'idle'; // idle, running, validation, completed
        let selectedRiskId = null; // ç”¨äºæŠ¥å‘Šè¯¦æƒ…é¡µè”åŠ¨
        let mockRisksData = []; // ç”¨äºåœ¨æŠ¥å‘Šè¯¦æƒ…é¡µä¹‹é—´å…±äº«æ•°æ®

        const mainContentEl = document.getElementById('mainContent');
        const sidebarEl = document.getElementById('sidebar');
        const sidebarOverlayEl = document.getElementById('sidebarOverlay');
        const openSidebarBtn = document.getElementById('openSidebar');
        const closeSidebarBtn = document.getElementById('closeSidebar');
        const modalEl = document.getElementById('modal');
        const modalBodyEl = document.getElementById('modalBody');
        const authStatusEl = document.getElementById('authStatus');
        
        // ç§»åŠ¨ç«¯ä¾§è¾¹æ æ§åˆ¶
        openSidebarBtn.onclick = () => { sidebarEl.classList.add('open'); sidebarOverlayEl.classList.remove('hidden'); };
        closeSidebarBtn.onclick = () => { sidebarEl.classList.remove('open'); sidebarOverlayEl.classList.add('hidden'); };
        sidebarOverlayEl.onclick = () => { sidebarEl.classList.remove('open'); sidebarOverlayEl.classList.add('hidden'); };


        // --- è¾…åŠ©å‡½æ•° ---

        /**
         * æ¨¡æ‹Ÿæ‰“å¼€æ¨¡æ€æ¡†
         * @param {string} title 
         * @param {string} contentHtml 
         */
        function openModal(title, contentHtml) {
            modalBodyEl.innerHTML = `
                <div class="flex justify-between items-center border-b border-primary pb-3 mb-4">
                    <h3 class="text-2xl font-semibold text-blue-400">${title}</h3>
                    <button onclick="closeModal()" class="text-gray-400 hover:text-gray-100 transition">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                    </button>
                </div>
                <div>
                    ${contentHtml}
                </div>
            `;
            modalEl.classList.remove('hidden');
            modalEl.classList.add('flex', 'fade-in');
        }

        /**
         * å…³é—­æ¨¡æ€æ¡†
         */
        function closeModal() {
            modalEl.classList.remove('flex', 'fade-in');
            modalEl.classList.add('hidden');
        }

        /**
         * æ¨¡æ‹Ÿç™»å½•çŠ¶æ€åˆ‡æ¢
         */
        function toggleAuth(role) {
            isUserLoggedIn = !isUserLoggedIn;
            isUserAdmin = (role === 'admin' && isUserLoggedIn);

            if (isUserLoggedIn) {
                authStatusEl.textContent = `(${isUserAdmin ? 'ç®¡ç†å‘˜' : 'æ™®é€šç”¨æˆ·'}) é€€å‡º`;
                renderPage('upload'); 
                if (!localStorage.getItem('hideSystemIntro')) {
                    setTimeout(() => showSystemIntro(), 500);
                }
            } else {
                authStatusEl.textContent = 'é€€å‡º/ç™»å½•';
                isUserAdmin = false;
                renderPage('login');
            }

            const adminButton = document.querySelector('button[data-page="admin"]');
            if (adminButton) {
                if (isUserLoggedIn && isUserAdmin) {
                    adminButton.disabled = false;
                    adminButton.classList.remove('opacity-50');
                } else {
                    adminButton.disabled = true;
                    adminButton.classList.add('opacity-50');
                }
            }
        }

        /**
         * ç™»å½•åç³»ç»Ÿç®€ä»‹+ä½¿ç”¨æŒ‡å¼•å¼¹çª—
         */
        function showSystemIntro() {
            const content = `
                <div class="space-y-4 text-gray-300">
                    <p>æ¬¢è¿ä½¿ç”¨éšç§æ”¿ç­–åˆè§„æ£€æµ‹ç³»ç»Ÿï¼æœ¬ç³»ç»Ÿæ—¨åœ¨å¸®åŠ©æ‚¨å¿«é€Ÿã€ç²¾å‡†åœ°æ£€æµ‹APPéšç§æ”¿ç­–çš„åˆè§„é£é™©ã€‚</p>
                    <ul class="list-disc list-inside space-y-2">
                        <li>ç¬¬ä¸€æ­¥ï¼šåœ¨**æ”¿ç­–ä¸Šä¼ ä¸æ£€æµ‹**é¡µé¢æäº¤æ‚¨çš„éšç§æ”¿ç­–ï¼ˆæ”¯æŒå¤šç§æ ¼å¼ï¼‰ã€‚</li>
                        <li>ç¬¬äºŒæ­¥ï¼šç³»ç»Ÿå°†è‡ªåŠ¨æ‰§è¡Œ**é¢„å¤„ç†ã€åˆ†å—ã€åŒ¹é…ã€è¯„ä¼°**ç­‰æµç¨‹ã€‚</li>
                        <li>ç¬¬ä¸‰æ­¥ï¼šåœ¨**åˆè§„æŠ¥å‘Šåˆ—è¡¨**ä¸­æŸ¥çœ‹å¹¶ä¸‹è½½è¯¦ç»†çš„åˆè§„æŠ¥å‘Šã€‚</li>
                    </ul>
                    <div class="flex items-center space-x-2 pt-2">
                        <input type="checkbox" id="noMoreShow" class="form-checkbox h-5 w-5 text-blue-600 bg-gray-700 border-gray-600 rounded">
                        <label for="noMoreShow" class="text-sm">ä¸‹æ¬¡ä¸å†æ˜¾ç¤º</label>
                    </div>
                    <div class="flex justify-end pt-4">
                        <button onclick="handleIntroClose()" class="px-6 py-2 bg-blue-600 rounded-lg hover:bg-blue-700 transition font-medium">å¼€å§‹ä½¿ç”¨</button>
                    </div>
                </div>
            `;
            openModal('ç³»ç»Ÿç®€ä»‹ä¸ä½¿ç”¨æŒ‡å¼•', content);
        }
        
        function handleIntroClose() {
            if (document.getElementById('noMoreShow').checked) {
                localStorage.setItem('hideSystemIntro', 'true');
            }
            closeModal();
        }


        /**
         * æ™ºèƒ½åˆ†å—ç½®ä¿¡åº¦æ ¡éªŒå¼¹çª— (æ¨¡æ‹Ÿ)
         */
        function showValidationModal() {
            const content = `
                <div class="space-y-4 text-gray-300">
                    <p class="text-lg font-medium text-yellow-400">ğŸš¨ æ™ºèƒ½åˆ†å—ç½®ä¿¡åº¦æç¤º</p>
                    <p>éƒ¨åˆ†æ–‡æœ¬å—çš„è‡ªåŠ¨åˆ†å—ç½®ä¿¡åº¦ä½äº 90% (ä¾‹å¦‚ 85%)ï¼Œå¯èƒ½å½±å“æœ€ç»ˆæ£€æµ‹å‡†ç¡®æ€§ã€‚</p>
                    <p>å»ºè®®æ‚¨è¿”å›ä¿®æ”¹æˆ–æ‰‹åŠ¨æ ¡éªŒåˆ†å—ç»“æœã€‚</p>
                    <div class="flex justify-end space-x-4 pt-4">
                        <button onclick="closeModal(); detectionStatus='idle'; renderPage('upload');" class="px-6 py-2 border border-gray-600 rounded-xl hover:bg-gray-700 transition font-medium">è¿”å›é‡æ–°ä¸Šä¼ </button>
                        <button onclick="closeModal(); startDetection(3);" class="px-6 py-2 bg-green-600 rounded-xl hover:bg-green-700 transition font-medium">ç»§ç»­æ£€æµ‹</button>
                    </div>
                </div>
            `;
            openModal('åˆ†å—ç»“æœæ ¡éªŒ (Page III)', content);
        }
        
        /**
         * æ¨¡æ‹Ÿå¯åŠ¨æ£€æµ‹æµç¨‹
         * @param {number} startStep ä»å“ªä¸€æ­¥å¼€å§‹ (1-5)
         */
        function startDetection(startStep = 1) {
            detectionStatus = 'running';
            renderPage('upload'); 

            const steps = ['é¢„å¤„ç†', 'åˆ†å—', 'æ³•è§„åŒ¹é…', 'æ¡ˆä¾‹æ£€ç´¢', 'é£é™©è¯„ä¼°'];
            let currentStepIndex = startStep; // 1-based index

            const interval = setInterval(() => {
                currentStepIndex++;
                renderPage('upload'); 

                if (currentStepIndex > steps.length) {
                    clearInterval(interval);
                    detectionStatus = 'completed';
                    renderPage('report-detail'); 
                } else if (currentStepIndex === 3 && startStep === 1) { 
                    clearInterval(interval);
                    detectionStatus = 'validation';
                    showValidationModal();
                }
            }, 1000);
        }
        
        /**
         * å¤„ç†é£é™©ç‚¹ç‚¹å‡»å’Œé«˜äº®è”åŠ¨
         * @param {number} riskId 
         */
        function handleRiskClick(riskId) {
            // 1. æ£€æŸ¥æ˜¯å¦åœ¨éšè—çš„å…ƒç´ ä¸Šç‚¹å‡»
            const wrapper = document.querySelector(`.risk-summary-card-wrapper[data-risk-id="${riskId}"]`);
            if (wrapper && wrapper.classList.contains('hidden')) {
                const selectEl = document.getElementById('riskFilterSelect');
                if (selectEl && selectEl.value !== 'all') {
                    selectEl.value = 'all';
                    filterRisksByType('all');
                }
            }


            // 2. æ›´æ–°é«˜äº®æ ‡è®°
            document.querySelectorAll('.violation-highlight').forEach(el => {
                el.classList.remove('selected');
            });
            const highlights = document.querySelectorAll(`[data-risk-id="${riskId}"]`);
            highlights.forEach(el => el.classList.add('selected'));
            
            // 3. æ»šåŠ¨åˆ°æ–‡æœ¬ä½ç½® (å¦‚æœæœ‰å¤šä¸ªé«˜äº®ï¼Œæ»šåŠ¨åˆ°ç¬¬ä¸€ä¸ª)
            if (highlights.length > 0) {
                highlights[0].scrollIntoView({ behavior: 'smooth', block: 'center' });
            }

            // 4. é€‰ä¸­é£é™©æ‘˜è¦å¡ç‰‡
            document.querySelectorAll('.risk-summary-card').forEach(el => {
                el.classList.remove('active');
            });
            const selectedCard = document.getElementById(`risk-card-${riskId}`);
            if (selectedCard) {
                selectedCard.classList.add('active');
                selectedCard.scrollIntoView({ behavior: 'smooth', block: 'nearest' });

                // 5. æ›´æ–°å¤„ç†åŒºå†…å®¹ (æ¨¡æ‹Ÿ)
                const risk = mockRisksData.find(r => r.id === riskId) || { id: riskId, note: '', category: 'æœªçŸ¥' };
                document.getElementById('riskHandlingArea').innerHTML = `
                    <p class="font-bold text-lg text-blue-400">è¿è§„é¡¹å¤„ç† (${risk.category} - #${riskId})</p>
                    <p class="text-sm text-gray-300 mb-2">${risk.title} - ${risk.keyword}</p>
                    <textarea id="riskNoteInput" rows="3" class="w-full p-3 bg-gray-700 rounded-lg text-white text-sm focus:ring-blue-500 focus:border-blue-500" placeholder="æ·»åŠ å¤„ç†å¤‡æ³¨...">${risk.note}</textarea>
                    <div class="flex justify-between text-sm pt-2">
                        <button class="text-blue-400 hover:text-blue-300 transition">æŸ¥çœ‹ä¼˜åŒ–ç¤ºä¾‹</button>
                        <button class="px-4 py-2 bg-green-600 rounded-xl hover:bg-green-700 transition font-medium">æ ‡è®°å·²å¤„ç†</button>
                    </div>
                `;
                // 6. å…³è”æ³•è§„ä¸æ¡ˆä¾‹
                document.getElementById('associatedLawArea').innerHTML = renderAssociatedLaw(risk.lawId);
            }

            selectedRiskId = riskId;
        }

        /**
         * æŠ¥å‘Šè¯¦æƒ…é¡µï¼šæŒ‰é£é™©ç±»å‹ç­›é€‰åŠŸèƒ½
         * @param {string} category é€‰ä¸­çš„é£é™©ç±»åˆ«
         */
        function filterRisksByType(category) {
            // 1. è¿‡æ»¤é£é™©æ‘˜è¦å¡ç‰‡
            const cardsContainer = document.getElementById('riskSummaryList');
            if (!cardsContainer) return;

            cardsContainer.querySelectorAll('.risk-summary-card-wrapper').forEach(wrapper => {
                const riskCategory = wrapper.getAttribute('data-risk-category');
                if (category === 'all' || riskCategory === category) {
                    wrapper.classList.remove('hidden');
                } else {
                    wrapper.classList.add('hidden');
                }
            });

            // 2. è¿‡æ»¤æ”¿ç­–æ–‡æœ¬é«˜äº®
            const policyTextContainer = document.getElementById('policyTextContainer');
            if (!policyTextContainer) return;

            const riskIdToCategory = {};
            mockRisksData.forEach(r => {
                riskIdToCategory[r.id] = r.category;
            });

            policyTextContainer.querySelectorAll('.violation-highlight').forEach(highlight => {
                const riskId = parseInt(highlight.getAttribute('data-risk-id'));
                const highlightCategory = riskIdToCategory[riskId];

                if (category === 'all' || highlightCategory === category) {
                    highlight.style.display = 'inline'; 
                } else {
                    highlight.style.display = 'none'; 
                }
            });
            
            // 3. å–æ¶ˆé€‰ä¸­çŠ¶æ€ï¼Œé¿å…é€‰ä¸­é¡¹è¢«éšè—
            if (selectedRiskId) {
                document.querySelectorAll('.violation-highlight.selected').forEach(el => el.classList.remove('selected'));
                document.querySelectorAll('.risk-summary-card.active').forEach(el => el.classList.remove('active'));
                document.getElementById('riskHandlingArea').innerHTML = `<p class="text-gray-500 text-sm p-4">è¯·ç‚¹å‡»å·¦ä¾§æˆ–ä¸Šæ–¹çš„é£é™©é¡¹å¡ç‰‡è¿›è¡Œå¤„ç†ã€‚</p>`;
                document.getElementById('associatedLawArea').innerHTML = `<p class="text-gray-500 text-sm p-4">ç‚¹å‡»é£é™©é¡¹åï¼Œæ­¤å¤„å°†æ˜¾ç¤ºå…³è”æ³•è§„ã€‚</p>`;
                selectedRiskId = null;
            }
        }
        
        /**
         * æ¸²æŸ“å…³è”æ³•è§„ä¸æ¡ˆä¾‹ (æ¨¡æ‹Ÿ)
         * @param {string} lawId 
         */
        function renderAssociatedLaw(lawId) {
            return `
                <div class="space-y-4">
                    <!-- å…³è”æ³•è§„ -->
                    <div class="space-y-3 p-3 bg-gray-700/50 rounded-lg">
                        <h3 class="text-lg font-medium text-gray-200 border-b border-gray-600 pb-2">å…³è”æ³•è§„ (<span class="text-red-400">æ ¸å¿ƒ</span>)</h3>
                        <p class="text-sm bg-gray-800 p-3 rounded-lg border-l-4 border-red-400">
                            <span class="font-semibold text-white">L001 - ä¸ªäººä¿¡æ¯ä¿æŠ¤æ³•</span><br>
                            <span class="text-gray-400 text-xs">ç¬¬27æ¡ï¼šæ”¶é›†ä¸ªäººä¿¡æ¯ï¼Œåº”å½“é™äºå®ç°å¤„ç†ç›®çš„çš„æœ€å°èŒƒå›´ã€‚</span>
                        </p>
                        <details class="text-sm bg-gray-800 p-3 rounded-lg border-l-4 border-yellow-400">
                            <summary class="font-semibold text-white cursor-pointer">å‚è€ƒæ³•è§„ (ç‚¹å‡»å±•å¼€)</summary>
                            <span class="text-gray-400 text-xs mt-2 block">L002 - ç½‘ç»œå®‰å…¨æ³• ç¬¬41æ¡ï¼šç½‘ç»œè¿è¥è€…æ”¶é›†ã€ä½¿ç”¨ä¸ªäººä¿¡æ¯ï¼Œåº”å½“ä¾æ³•å–å¾—åŒæ„...</span>
                        </details>
                    </div>

                    <!-- æ¡ˆä¾‹å‚è€ƒ -->
                    <div class="space-y-3 pt-4 border-t border-gray-700 p-3 bg-gray-700/50 rounded-lg">
                        <h3 class="text-lg font-medium text-gray-200 border-b border-gray-600 pb-2">æ¡ˆä¾‹å‚è€ƒ</h3>
                        <div class="text-sm bg-gray-800 p-3 rounded-lg border-l-4 border-blue-400">
                            <p class="font-semibold text-white">C01 - XXç¤¾äº¤åº”ç”¨éæ³•æ”¶é›†æ¡ˆ</p>
                            <p class="text-xs text-gray-400">æ¥æº: XXç½‘ä¿¡åŠ | åˆ¤ç½šç»“æœ: è´£ä»¤æ•´æ”¹å¹¶ç½šæ¬¾ 50 ä¸‡å…ƒ</p>
                            <button class="text-xs text-blue-400 mt-1 hover:text-blue-300">æŸ¥çœ‹æ›´å¤š</button>
                        </div>
                    </div>
                </div>
            `;
        }


        // --- é¡µé¢æ¸²æŸ“å‡½æ•° ---

        /**
         * æ¸²æŸ“ç™»å½•/æ³¨å†Œé¡µ (Page I)
         */
        function renderLoginPage() {
            const html = `
                <div class="flex items-center justify-center min-h-[80vh] fade-in">
                    <div class="w-full max-w-sm bg-card p-8 rounded-2xl shadow-2xl space-y-6 border border-primary">
                        <header class="text-center">
                            <h2 class="text-3xl font-extrabold text-blue-400">ç³»ç»Ÿç™»å½•</h2>
                            <p class="text-gray-400 mt-1">ç¤¾äº¤ç±»APPéšç§æ”¿ç­–åˆè§„æ£€æµ‹</p>
                        </header>
                        
                        <!-- æƒé™åˆ‡æ¢æ ‡ç­¾ -->
                        <div class="bg-gray-700 p-1 rounded-xl flex mb-6">
                            <button onclick="isUserAdmin=false; renderPage('login')" class="w-1/2 px-4 py-2 rounded-lg ${!isUserAdmin ? 'bg-blue-600 text-white font-semibold' : 'text-gray-400 hover:bg-gray-600'} transition duration-200">
                                æ™®é€šç”¨æˆ·
                            </button>
                            <button onclick="isUserAdmin=true; renderPage('login')" class="w-1/2 px-4 py-2 rounded-lg ${isUserAdmin ? 'bg-blue-600 text-white font-semibold' : 'text-gray-400 hover:bg-gray-600'} transition duration-200">
                                ç®¡ç†å‘˜
                            </button>
                        </div>

                        <!-- ç™»å½•è¡¨å• -->
                        <div class="space-y-4">
                            <div class="relative">
                                <input type="text" placeholder="æ‰‹æœºå·/è´¦å·" class="w-full p-3 pl-12 rounded-xl bg-gray-700 border border-gray-600 focus:border-blue-500 text-white" value="user123">
                                <svg class="w-5 h-5 absolute top-1/2 transform -translate-y-1/2 left-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                            </div>
                            <div class="relative">
                                <input type="password" placeholder="å¯†ç /éªŒè¯ç " class="w-full p-3 pl-12 rounded-xl bg-gray-700 border border-gray-600 focus:border-blue-500 text-white" value="******">
                                <svg class="w-5 h-5 absolute top-1/2 transform -translate-y-1/2 left-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg>
                            </div>
                            
                            <div class="flex justify-between text-sm">
                                <a href="#" class="text-blue-400 hover:text-blue-300">å¿˜è®°å¯†ç </a>
                                <a href="#" class="text-blue-400 hover:text-blue-300">æ³¨å†Œæ–°è´¦å·</a>
                            </div>

                            <button onclick="toggleAuth('${isUserAdmin ? 'admin' : 'user'}')" class="w-full py-3 bg-blue-600 text-white font-bold rounded-xl text-lg shadow-lg shadow-blue-500/50 hover:bg-blue-700 transition duration-300">
                                ç™»å½•${isUserAdmin ? ' (ç®¡ç†å‘˜)' : ''}
                            </button>
                        </div>
                        
                        <footer class="text-center text-xs text-gray-500 pt-4 border-t border-gray-700">
                            <p>ç™»å½•å³è¡¨ç¤ºæ‚¨åŒæ„ã€Šç”¨æˆ·æœåŠ¡åè®®ã€‹å’Œã€Šéšç§æ”¿ç­–ã€‹</p>
                        </footer>
                    </div>
                </div>
            `;
            return html;
        }

        /**
         * æ¸²æŸ“éšç§æ”¿ç­–ä¸Šä¼ ä¸æ£€æµ‹é¡µ (Page II)
         */
        function renderUploadPage() {
            const steps = ['é¢„å¤„ç†', 'åˆ†å—', 'æ³•è§„åŒ¹é…', 'æ¡ˆä¾‹æ£€ç´¢', 'é£é™©è¯„ä¼°'];
            let currentStepIndex = detectionStatus === 'completed' ? 5 : (detectionStatus === 'validation' ? 2 : (detectionStatus === 'running' ? 3 : 0)); // 0-based index
            const percentage = (currentStepIndex / steps.length) * 100;
            
            const progressHtml = `
                <div class="flex justify-between items-start mb-4 pt-4 relative">
                    ${steps.map((step, index) => {
                        const isCompleted = index < currentStepIndex;
                        const isActive = index === currentStepIndex && detectionStatus === 'running';
                        return `
                            <div class="flex flex-col items-center w-1/5 relative z-10">
                                <div class="progress-step w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold border-2 border-gray-600 ${isCompleted || isActive ? 'active' : 'bg-gray-700 text-gray-500'}">
                                    ${index + 1}
                                </div>
                                <span class="mt-2 text-center text-xs ${isCompleted || isActive ? 'text-blue-400 font-semibold' : 'text-gray-400'}">${step}</span>
                            </div>
                        `;
                    }).join('')}
                    <!-- è¿›åº¦çº¿ -->
                    <div class="progress-line absolute top-[62px] left-[50px] right-[50px] overflow-hidden rounded-full">
                        <div class="progress-line active" style="width: ${percentage}%;"></div>
                    </div>
                </div>
            `;

            const html = `
                <div class="max-w-4xl mx-auto space-y-8 fade-in">
                    <h1 class="text-3xl font-extrabold text-white border-b border-primary pb-3">æ”¿ç­–ä¸Šä¼ ä¸æ£€æµ‹</h1>
                    
                    <!-- APP åŸºç¡€ä¿¡æ¯å¡«å†™ -->
                    <div class="bg-card p-6 rounded-xl shadow-xl space-y-4 border border-primary">
                        <h2 class="text-xl font-semibold text-blue-400">APP åŸºç¡€ä¿¡æ¯</h2>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <input type="text" placeholder="APP åç§° (e.g., å¾®èŠ)" class="p-3 rounded-lg bg-gray-700 border border-gray-600 focus:border-blue-500 text-white">
                            <input type="text" placeholder="æ‰€å±å…¬å¸ (e.g., è…¾é©¬ç§‘æŠ€)" class="p-3 rounded-lg bg-gray-700 border border-gray-600 focus:border-blue-500 text-white">
                            <input type="text" placeholder="ç‰ˆæœ¬å· (e.g., 3.2.1)" class="p-3 rounded-lg bg-gray-700 border border-gray-600 focus:border-blue-500 text-white">
                        </div>
                    </div>

                    <!-- æ–‡ä»¶ä¸Šä¼ åŒº -->
                    <div class="bg-card p-6 rounded-xl shadow-xl space-y-4 border border-primary">
                        <h2 class="text-xl font-semibold text-blue-400">éšç§æ”¿ç­–æ–‡ä»¶ä¸Šä¼ </h2>
                        
                        <!-- æ–‡ä»¶æ‹–æ‹½åŒº (ç¾åŒ–) -->
                        <div class="file-drop-zone border-gray-600 p-10 rounded-xl text-center transition duration-200 cursor-pointer hover:bg-gray-700/50">
                            <svg class="w-10 h-10 mx-auto text-blue-400 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0L8 8m4-4v12"></path></svg>
                            <p class="text-gray-300 font-medium text-lg">æ‹–æ”¾ PDF / HTML / TXT æ–‡ä»¶åˆ°æ­¤</p>
                            <p class="text-sm text-gray-500 mt-1">æˆ– <span class="text-blue-400 font-semibold">ç‚¹å‡»ä¸Šä¼ </span>ï¼Œæ”¯æŒæ‰¹é‡æ–‡ä»¶ä¸Šä¼ </p>
                        </div>

                        <div class="flex flex-col sm:flex-row items-center space-y-2 sm:space-y-0 sm:space-x-2">
                            <input type="url" placeholder="æˆ–è¾“å…¥ç½‘é¡µé“¾æ¥ (URL) è¿›è¡Œæ£€æµ‹" class="flex-grow w-full p-3 rounded-lg bg-gray-700 border border-gray-600 focus:border-blue-500 text-white">
                            <button class="w-full sm:w-auto px-4 py-3 bg-blue-600 rounded-xl hover:bg-blue-700 text-white transition">æ£€æµ‹é“¾æ¥</button>
                        </div>

                        <!-- æ–‡æœ¬æ¸…æ´—é¢„è§ˆ -->
                        <div class="pt-4 space-y-2 border-t border-primary">
                            <h3 class="text-lg font-semibold text-gray-300">æ¸…æ´—åæ–‡æœ¬é¢„è§ˆ <span class="text-xs text-gray-500">(æ”¯æŒæ‰‹åŠ¨ç¼–è¾‘ä¿®æ”¹)</span></h3>
                            <textarea rows="6" class="w-full p-4 rounded-lg bg-gray-700 border border-gray-600 text-white text-sm focus:ring-blue-500 focus:border-blue-500" placeholder="æ¸…æ´—åçš„æ–‡æœ¬å°†åœ¨æ­¤å¤„æ˜¾ç¤º... (æ”¯æŒæ‰‹åŠ¨ç¼–è¾‘ä¿®æ”¹)">
[è‡ªåŠ¨æ¸…æ´—åæ–‡æœ¬] ...æˆ‘ä»¬éå¸¸é‡è§†æ‚¨çš„ä¸ªäººä¿¡æ¯å’Œéšç§ä¿æŠ¤ã€‚æˆ‘ä»¬ä¼šæ ¹æ®æ³•å¾‹æ³•è§„è¦æ±‚ï¼Œåœ¨æ‚¨çš„åŒæ„ä¸‹æ”¶é›†æ‚¨çš„æ‰‹æœºå·ç ã€è®¾å¤‡ä¿¡æ¯ã€åœ°ç†ä½ç½®ä¿¡æ¯ç­‰ï¼Œç”¨äºæä¾›èŠå¤©ã€ç¤¾äº¤å’Œæ¨èæœåŠ¡ã€‚
                            </textarea>
                            <div class="flex justify-between items-center">
                                <button class="text-sm px-4 py-2 rounded-xl bg-red-600 hover:bg-red-700 transition text-white font-medium">æ¢å¤åŸå§‹æ–‡æœ¬</button>
                                <p class="text-sm text-gray-500">å·²è¾“å…¥ 4500 å­— / å»ºè®®å­—æ•° 5000-8000 å­—</p>
                            </div>
                        </div>
                    </div>

                    <!-- æ£€æµ‹è¿›åº¦ä¸æ§åˆ¶ -->
                    <div class="bg-card p-6 rounded-xl shadow-xl space-y-4 border border-primary">
                        <h2 class="text-xl font-semibold text-blue-400">æ£€æµ‹è¿›åº¦å±•ç¤º</h2>
                        <!-- ä¼˜åŒ–åçš„è¿›åº¦æ¡ -->
                        <div class="relative pt-6 pb-4">
                           ${progressHtml}
                        </div>
                        
                        <!-- æ§åˆ¶æŒ‰é’® -->
                        <div class="flex justify-between pt-4 border-t border-primary">
                            <button onclick="detectionStatus = 'idle'; renderPage('upload')" class="px-6 py-3 border border-gray-600 text-gray-300 rounded-xl hover:bg-gray-700 transition font-medium">å–æ¶ˆæ£€æµ‹</button>
                            <button onclick="startDetection()" class="px-8 py-3 bg-green-600 text-white font-bold rounded-xl text-lg shadow-lg shadow-green-500/50 hover:bg-green-700 transition duration-300 disabled:opacity-50"
                                ${detectionStatus === 'running' ? 'disabled' : ''}>
                                ${detectionStatus === 'running' ? 'æ£€æµ‹è¿›è¡Œä¸­...' : 'æäº¤æ£€æµ‹'}
                            </button>
                        </div>
                    </div>

                </div>
            `;
            return html;
        }

        /**
         * æ¸²æŸ“åˆè§„æŠ¥å‘Šåˆ—è¡¨é¡µ (Page IV)
         */
        function renderReportListPage() {
            // æ¨¡æ‹Ÿæ•°æ®
            const reports = [
                { id: 1001, time: '2025-11-16 10:30', app: 'å¾®èŠ', company: 'è…¾é©¬ç§‘æŠ€', risk: 'é«˜é£é™©', rate: '55%', format: 'PDF' },
                { id: 1002, time: '2025-11-15 14:00', app: 'é…·ä¹åˆ†äº«', company: 'åˆ›æ˜“å·¥ä½œå®¤', risk: 'ä¸­é£é™©', rate: '78%', format: 'HTML' },
                { id: 1003, time: '2025-11-01 09:15', app: 'å¾®èŠ', company: 'è…¾é©¬ç§‘æŠ€', risk: 'ä½é£é™©', rate: '92%', format: 'PDF' },
                { id: 1004, time: '2025-10-28 17:50', app: 'èŒå® æ—¥è®°', company: 'çˆ±å® ç½‘ç»œ', risk: 'ä½é£é™©', rate: '88%', format: 'TXT' },
            ];
            
            const tableRowsHtml = reports.map(r => `
                <tr class="border-b border-gray-700 hover:bg-gray-700 transition duration-150 cursor-pointer">
                    <td class="p-4 text-sm font-medium text-gray-300">${r.time}</td>
                    <td class="p-4 text-sm">${r.app}</td>
                    <td class="p-4 text-sm">${r.company}</td>
                    <td class="p-4 text-sm">
                        <span class="px-3 py-1 text-xs font-semibold rounded-full ${r.risk === 'é«˜é£é™©' ? 'bg-red-900 text-red-300' : (r.risk === 'ä¸­é£é™©' ? 'bg-yellow-900 text-yellow-300' : 'bg-green-900 text-green-300')}">
                            ${r.risk}
                        </span>
                    </td>
                    <td class="p-4 text-sm text-green-400 font-bold">${r.rate}</td>
                    <td class="p-4 text-sm">${r.format}</td>
                    <td class="p-4 text-sm flex space-x-2">
                        <button onclick="renderPage('report-detail')" class="text-blue-400 hover:text-blue-300 transition">é¢„è§ˆ/è¯¦æƒ…</button>
                        <button class="text-gray-400 hover:text-gray-300 transition">ä¸‹è½½</button>
                        <button class="text-gray-400 hover:text-gray-300 transition">åˆ†äº« (1å¤©)</button>
                    </td>
                </tr>
            `).join('');

            const html = `
                <div class="max-w-7xl mx-auto space-y-8 fade-in">
                    <h1 class="text-3xl font-extrabold text-white border-b border-primary pb-3">åˆè§„æŠ¥å‘Šåˆ—è¡¨</h1>

                    <!-- ç­›é€‰ä¸æ§åˆ¶åŒº -->
                    <div class="bg-card p-4 rounded-xl shadow-xl space-y-4 border border-primary">
                        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center space-y-3 sm:space-y-0">
                            <!-- å¤šæ¡ä»¶ç­›é€‰ -->
                            <div class="flex flex-wrap gap-3">
                                <select class="p-2 rounded-xl bg-gray-700 border border-gray-600 text-sm">
                                    <option>ç­›é€‰ï¼šæ£€æµ‹æ—¶é—´</option>
                                </select>
                                <select class="p-2 rounded-xl bg-gray-700 border border-gray-600 text-sm">
                                    <option>ç­›é€‰ï¼šAPPåç§°</option>
                                </select>
                                <select class="p-2 rounded-xl bg-gray-700 border border-gray-600 text-sm">
                                    <option>ç­›é€‰ï¼šé£é™©ç­‰çº§</option>
                                    <option>é«˜é£é™©</option>
                                    <option>ä¸­é£é™©</option>
                                    <option>ä½é£é™©</option>
                                </select>
                            </div>
                            
                            <!-- æ‰¹é‡æ“ä½œ -->
                            <div class="flex gap-3">
                                <button class="px-4 py-2 text-sm bg-indigo-600 rounded-xl hover:bg-indigo-700 transition font-medium">æ‰¹é‡ä¸‹è½½æŠ¥å‘Š (ZIP)</button>
                            </div>
                        </div>

                        <!-- ç­›é€‰çŠ¶æ€æ ‡ç­¾ -->
                        <div class="flex flex-wrap gap-2 text-sm pt-2 border-t border-gray-700">
                            <span class="px-3 py-1 bg-blue-900 rounded-full text-blue-300 flex items-center">APP: å¾®èŠ <button class="ml-2 text-xs hover:text-white">âœ•</button></span>
                            <span class="px-3 py-1 bg-blue-900 rounded-full text-blue-300 flex items-center">é£é™©: é«˜/ä¸­ <button class="ml-2 text-xs hover:text-white">âœ•</button></span>
                        </div>
                    </div>

                    <!-- æŠ¥å‘Šè¡¨æ ¼ -->
                    <div class="overflow-x-auto bg-card rounded-xl shadow-xl border border-primary">
                        <table class="min-w-full divide-y divide-gray-700">
                            <thead class="bg-gray-700">
                                <tr>
                                    <th class="p-4 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">æ£€æµ‹æ—¶é—´</th>
                                    <th class="p-4 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">APPåç§°</th>
                                    <th class="p-4 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">æ‰€å±å…¬å¸</th>
                                    <th class="p-4 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">é£é™©ç­‰çº§</th>
                                    <th class="p-4 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">åˆè§„ç‡</th>
                                    <th class="p-4 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">æ ¼å¼</th>
                                    <th class="p-4 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-700">
                                ${tableRowsHtml}
                            </tbody>
                        </table>
                    </div>
                    
                </div>
            `;
            return html;
        }

        /**
         * æ¸²æŸ“æŠ¥å‘Šè¯¦æƒ…é¡µ (Page V)
         */
        function renderReportDetailPage() {
            // æ¨¡æ‹Ÿåˆè§„æŠ¥å‘Šæ•°æ® (æ–°å¢ category å­—æ®µ)
            const risks = [
                { id: 1, type: 'é«˜é£é™©', title: 'è¿‡åº¦æ”¶é›†ä¸ªäººä¿¡æ¯', keyword: 'åœ°ç†ä½ç½®æƒé™', lawId: 'L001', solved: false, note: '', category: 'ä¿¡æ¯æ”¶é›†' },
                { id: 2, type: 'ä¸­é£é™©', title: 'æœªæä¾›æ’¤å›åŒæ„æœºåˆ¶', keyword: 'å¹¿å‘Šæ¨èç›®çš„', lawId: 'L002', solved: true, note: 'å·²å¤„ç†ï¼šå·²æ·»åŠ â€œä¸€é”®å…³é—­ä¸ªæ€§åŒ–æ¨èâ€æŒ‰é’®', category: 'ç”¨æˆ·æƒåˆ©' },
                { id: 3, type: 'ä½é£é™©', title: 'å®¢æœè”ç³»æ–¹å¼ä¸æ˜ç¡®', keyword: 'å®¢æœéƒ¨é—¨', lawId: 'L003', solved: false, note: '', category: 'è”ç³»æ–¹å¼' },
                { id: 4, type: 'ä¸­é£é™©', title: 'æœªæ˜ç¡®å­˜å‚¨æœŸé™', keyword: 'å‚¨å­˜è‡³åˆ é™¤', lawId: 'L004', solved: false, note: '', category: 'ä¿¡æ¯å­˜å‚¨' },
                { id: 5, type: 'é«˜é£é™©', title: 'æœªå‘ŠçŸ¥ç¬¬ä¸‰æ–¹SDKé›†æˆ', keyword: 'ç¬¬ä¸‰æ–¹SDK', lawId: 'L005', solved: false, note: '', category: 'ä¿¡æ¯å…±äº«' },
            ];
            
            // å°†æ•°æ®å­˜å…¥å…¨å±€å˜é‡ä¾›ç­›é€‰å‡½æ•°ä½¿ç”¨
            mockRisksData = risks;
            
            // æå–å”¯ä¸€ç±»åˆ«ç”¨äºç­›é€‰ä¸‹æ‹‰æ¡†
            const categories = [...new Set(risks.map(r => r.category))];

            // æ¨¡æ‹Ÿæ”¿ç­–æ–‡æœ¬
            const policyText = `
                <p>ç¬¬ä¸€ç«  éšç§æ”¿ç­–å¼•è¨€ã€‚æ„Ÿè°¢æ‚¨é€‰æ‹©ä½¿ç”¨å¾®èŠæœåŠ¡ã€‚æˆ‘ä»¬éå¸¸é‡è§†æ‚¨çš„ä¸ªäººä¿¡æ¯ä¿æŠ¤ã€‚</p>
                <p>ç¬¬äºŒç«  ä¿¡æ¯æ”¶é›†ä¸ä½¿ç”¨ã€‚ä¸ºäº†å®ç°æ‚¨çš„èŠå¤©åŠŸèƒ½ï¼Œæˆ‘ä»¬éœ€è¦æ”¶é›†æ‚¨çš„æ‰‹æœºå·ç å’Œè®¾å¤‡è¯†åˆ«ç ã€‚æ­¤å¤–ï¼Œå½“æ‚¨ä½¿ç”¨æœ‹å‹åœˆåŠŸèƒ½æ—¶ï¼Œæˆ‘ä»¬ä¼šè¯·æ±‚è·å–<span class="violation-highlight" data-risk-id="1">åœ°ç†ä½ç½®æƒé™</span>ï¼Œè¿™æ˜¯<span class="violation-highlight" data-risk-id="1">è¿‡åº¦æ”¶é›†ä¸ªäººä¿¡æ¯</span>çš„é£é™©ç‚¹ï¼Œè¿åäº†æœ€å°å¿…è¦åŸåˆ™ã€‚æˆ‘ä»¬è¿˜é›†æˆäº†<span class="violation-highlight" data-risk-id="5">ç¬¬ä¸‰æ–¹SDK</span>ç”¨äºæ•°æ®åˆ†æï¼Œä½†<span class="violation-highlight" data-risk-id="5">æœªå‘ŠçŸ¥ç¬¬ä¸‰æ–¹SDKé›†æˆ</span>åŠå…¶ç›®çš„ã€‚</p>
                <p>ç¬¬ä¸‰ç«  ä¿¡æ¯çš„å…±äº«ä¸å…¬å¼€ã€‚æˆ‘ä»¬æ‰¿è¯ºé™¤éè·å¾—æ‚¨çš„æ˜ç¡®æˆæƒï¼Œå¦åˆ™ä¸ä¼šå°†æ‚¨çš„ä¸ªäººä¿¡æ¯å…±äº«ç»™ä»»ä½•ç¬¬ä¸‰æ–¹å…¬å¸ï¼Œä½†ä¸ºäº†<span class="violation-highlight" data-risk-id="2">å¹¿å‘Šæ¨èç›®çš„</span>ï¼Œå¯èƒ½ä¼šä¸åˆä½œæ–¹å…±äº«å»æ ‡è¯†åŒ–çš„ä¿¡æ¯ï¼Œä½†**æœªæä¾›æ’¤å›åŒæ„çš„é€‰é¡¹**ã€‚</p>
                <p>ç¬¬å››ç«  ä¿¡æ¯çš„å­˜å‚¨ä¸æœŸé™ã€‚ç”¨æˆ·çš„èŠå¤©è®°å½•å°†<span class="violation-highlight" data-risk-id="4">å‚¨å­˜è‡³åˆ é™¤</span>ã€‚æ­¤è¡¨è¿°ä¸åˆè§„ï¼Œ<span class="violation-highlight" data-risk-id="4">æœªæ˜ç¡®å­˜å‚¨æœŸé™</span>ã€‚</p>
                <p>ç¬¬äº”ç«  æ‚¨çš„æƒåˆ©ã€‚æ‚¨æœ‰æƒè®¿é—®ã€ä¿®æ”¹å’Œåˆ é™¤æ‚¨çš„ä¸ªäººä¿¡æ¯ã€‚è‹¥æ‚¨å¯¹æœ¬æ”¿ç­–æœ‰ä»»ä½•ç–‘é—®ï¼Œè¯·è”ç³»æˆ‘ä»¬çš„<span class="violation-highlight" data-risk-id="3">å®¢æœéƒ¨é—¨</span>ã€‚è¯¥è¡¨è¿°è¿‡äºæ¨¡ç³Šï¼Œ<span class="violation-highlight" data-risk-id="3">å®¢æœè”ç³»æ–¹å¼ä¸æ˜ç¡®</span>ã€‚</p>
            `.trim();
            
            // é£é™©æ‘˜è¦å¡ç‰‡ HTML (æ–°å¢ wrapper å’Œ category å±æ€§)
            const riskSummaryHtml = risks.map(r => {
                const colorMap = {
                    'é«˜é£é™©': 'border-red-600',
                    'ä¸­é£é™©': 'border-yellow-600',
                    'ä½é£é™©': 'border-green-600'
                };
                const bgMap = {
                    'é«˜é£é™©': 'bg-red-900/20',
                    'ä¸­é£é™©': 'bg-yellow-900/20',
                    'ä½é£é™©': 'bg-green-900/20'
                };

                return `
                    <div class="risk-summary-card-wrapper" data-risk-id="${r.id}" data-risk-category="${r.category}">
                        <div id="risk-card-${r.id}" onclick="handleRiskClick(${r.id})" 
                             class="risk-summary-card p-4 rounded-xl cursor-pointer mb-3 shadow-md ${colorMap[r.type]} ${bgMap[r.type]}">
                            <div class="flex justify-between items-start">
                                <span class="font-bold text-base ${r.type === 'é«˜é£é™©' ? 'text-red-400' : (r.type === 'ä¸­é£é™©' ? 'text-yellow-400' : 'text-green-400')}">${r.type}: ${r.title}</span>
                                <span class="text-xs px-2 py-0.5 rounded-full ${r.solved ? 'bg-green-600 text-white' : 'bg-gray-600 text-gray-300'}">${r.solved ? 'å·²å¤„ç†' : 'å¾…å¤„ç†'}</span>
                            </div>
                            <p class="text-xs text-gray-400 mt-1 flex justify-between">
                                <span><span class="text-indigo-300">${r.category}</span> | å…³é”®è¯: ${r.keyword}</span>
                                <span class="text-gray-500">ID: #${r.id}</span>
                            </p>
                            <p class="text-xs text-gray-500 mt-2 line-clamp-2">${r.note || 'ç‚¹å‡»æ­¤å¤„æŸ¥çœ‹è¯¦æƒ…ï¼Œå¹¶æ ‡è®°å·²å¤„ç†ã€‚'}</p>
                        </div>
                    </div>
                `;
            }).join('');

            // ç­›é€‰ä¸‹æ‹‰æ¡† HTML
            const filterSelectHtml = `
                <select id="riskFilterSelect" onchange="filterRisksByType(this.value)" 
                    class="text-sm px-4 py-2 bg-gray-700 rounded-xl border border-gray-600 text-white focus:ring-blue-500 focus:border-blue-500 hover:bg-gray-600 transition">
                    <option value="all" class="bg-gray-800">æŒ‰ç±»å‹ç­›é€‰ (å…¨éƒ¨)</option>
                    ${categories.map(cat => `<option value="${cat}" class="bg-gray-800">${cat}</option>`).join('')}
                </select>
            `;


            const html = `
                <div class="max-w-7xl mx-auto space-y-6 fade-in">
                    
                    <!-- æŠ¥å‘Šæ€»è§ˆä¸æ“ä½œ -->
                    <header class="flex flex-col sm:flex-row justify-between items-start sm:items-center pb-4 border-b border-primary sticky top-0 bg-gray-900 z-10">
                         <h1 class="text-3xl font-extrabold text-blue-400">åˆè§„æŠ¥å‘Šè¯¦æƒ… <span class="text-xl text-gray-400">(å¾®èŠ V3.2.1)</span></h1>
                         <div class="flex space-x-3 mt-3 sm:mt-0">
                             <button class="text-sm px-4 py-2 bg-indigo-600 rounded-xl hover:bg-indigo-700 transition font-medium">å¯¼å‡ºæ•´æ”¹æ¸…å•</button>
                             <button class="text-sm px-4 py-2 bg-gray-600 rounded-xl hover:bg-gray-500 transition font-medium">å¯¹æ¯”å†å²ç‰ˆæœ¬</button>
                         </div>
                    </header>
                    
                    <!-- é¡¶éƒ¨åˆ†æç»Ÿè®¡å¡ç‰‡ -->
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div class="p-4 bg-card rounded-xl text-center shadow-lg border-b-4 border-red-500">
                            <p class="text-xs text-gray-400">æ€»é£é™©é¡¹</p>
                            <p class="text-4xl font-extrabold text-red-400">5</p>
                        </div>
                        <div class="p-4 bg-card rounded-xl text-center shadow-lg border-b-4 border-yellow-500">
                            <p class="text-xs text-gray-400">å¾…å¤„ç†é«˜/ä¸­é£é™©</p>
                            <p class="text-4xl font-extrabold text-yellow-400">3</p>
                        </div>
                        <div class="p-4 bg-card rounded-xl text-center shadow-lg border-b-4 border-green-500">
                            <p class="text-xs text-gray-400">å·²å¤„ç†æ•°é‡</p>
                            <p class="text-4xl font-extrabold text-green-400">1</p>
                        </div>
                        <div class="p-4 bg-card rounded-xl text-center shadow-lg border-b-4 border-blue-500">
                            <p class="text-xs text-gray-400">åˆè§„ç‡è¯„åˆ†</p>
                            <p class="text-4xl font-extrabold text-blue-400">92<span class="text-xl">%</span></p>
                        </div>
                    </div>

                    <!-- æ ¸å¿ƒä¸¤æ å¸ƒå±€ -->
                    <div class="flex flex-col lg:flex-row space-y-6 lg:space-y-0 lg:space-x-6">
                        
                        <!-- å·¦æ : éšç§æ”¿ç­–æ–‡æœ¬ä¸é«˜äº® -->
                        <div class="lg:w-1/2 w-full bg-card p-6 rounded-xl shadow-2xl space-y-4 border border-primary">
                            <div class="flex justify-between items-center border-b border-gray-700 pb-3">
                                <h2 class="text-2xl font-semibold text-gray-200">æ”¿ç­–æ–‡æœ¬ä¸è¿è§„å®šä½</h2>
                                <div class="flex space-x-3 items-center">
                                    <span class="text-sm text-gray-400">ç­›é€‰é«˜äº®:</span>
                                    ${filterSelectHtml}
                                </div>
                            </div>
                            
                            <!-- æ–‡æœ¬å†…å®¹ï¼Œç»‘å®šç‚¹å‡»äº‹ä»¶ -->
                            <div id="policyTextContainer" class="h-[650px] overflow-y-auto hide-scrollbar text-sm text-primary leading-relaxed space-y-4 p-2">
                                <p class="text-xs text-gray-500 mb-4 bg-gray-800 p-3 rounded-lg border-l-2 border-blue-400">ï¼ˆè¿è§„å†…å®¹å·²é«˜äº®æ˜¾ç¤ºï¼Œç‚¹å‡»é«˜äº®éƒ¨åˆ†å¯è”åŠ¨å³ä¾§é£é™©é¡¹è¿›è¡Œå¤„ç†ã€‚ï¼‰</p>
                                ${policyText}
                            </div>
                        </div>

                        <!-- å³æ : é£é™©æ‘˜è¦ã€å¤„ç†ä¸æ³•è§„å‚è€ƒ -->
                        <div class="lg:w-1/2 w-full flex flex-col space-y-6">
                            
                            <!-- æ¨¡å— A: é£é™©ç‚¹æ‘˜è¦åˆ—è¡¨ -->
                            <div class="bg-card p-6 rounded-xl shadow-2xl space-y-4 flex-none border border-primary">
                                <h2 class="text-xl font-semibold text-red-400 border-b border-gray-700 pb-3">é£é™©ç‚¹æ‘˜è¦åˆ—è¡¨</h2>
                                <div id="riskSummaryList" class="text-sm h-72 overflow-y-auto hide-scrollbar pr-2">
                                    ${riskSummaryHtml}
                                </div>
                            </div>

                            <!-- æ¨¡å— B: é£é™©å¤„ç†åŒº -->
                            <div id="riskHandlingAreaWrapper" class="bg-card p-6 rounded-xl shadow-2xl space-y-4 flex-none border border-primary">
                                <h2 class="text-xl font-semibold text-blue-400 border-b border-gray-700 pb-3">é£é™©å¤„ç†ä¸å¤‡æ³¨</h2>
                                <div id="riskHandlingArea" class="space-y-3 min-h-[120px]">
                                    <p class="text-gray-500 text-sm p-4 text-center">è¯·ç‚¹å‡»ä¸Šæ–¹çš„é£é™©é¡¹å¡ç‰‡è¿›è¡Œå¤„ç†ã€‚</p>
                                </div>
                            </div>
                            
                            <!-- æ¨¡å— C: å…³è”æ³•è§„ä¸æ¡ˆä¾‹ -->
                            <div class="bg-card p-6 rounded-xl shadow-2xl space-y-4 flex-grow border border-primary">
                                <h2 class="text-xl font-semibold text-green-400 border-b border-gray-700 pb-3">å…³è”æ³•è§„ä¸æ¡ˆä¾‹å‚è€ƒ</h2>
                                <div id="associatedLawArea" class="space-y-3 min-h-[200px]">
                                    <p class="text-gray-500 text-sm p-4 text-center">ç‚¹å‡»é£é™©é¡¹åï¼Œæ­¤å¤„å°†æ˜¾ç¤ºå…³è”æ³•è§„ã€‚</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // æ³¨å†Œäº‹ä»¶ç›‘å¬å™¨ï¼šç‚¹å‡»é«˜äº®æ–‡æœ¬è§¦å‘è”åŠ¨
            setTimeout(() => {
                const container = document.getElementById('policyTextContainer');
                if (container) {
                    container.addEventListener('click', (e) => {
                        const target = e.target.closest('.violation-highlight');
                        if (target) {
                            const riskId = parseInt(target.getAttribute('data-risk-id'));
                            handleRiskClick(riskId);
                        }
                    });
                }
                
                // é»˜è®¤é€‰ä¸­ç¬¬ä¸€ä¸ªé£é™©é¡¹
                if (risks.length > 0) {
                     handleRiskClick(risks[0].id);
                }

            }, 0);
            return html;
        }

        /**
         * æ¸²æŸ“ç®¡ç†å‘˜ä¸“å±é¡µé¢ï¼šæ³•è§„/æ¡ˆä¾‹åº“ç»´æŠ¤é¡µ (Page VI)
         */
        function renderAdminPage() {
            if (!isUserAdmin) return `<div class="p-8 text-center text-red-500 bg-card rounded-xl shadow-lg mt-10">âŒ æƒé™ä¸è¶³ï¼Œè¯·ä»¥ç®¡ç†å‘˜èº«ä»½ç™»å½•ã€‚</div>`;
            const html = `
                <div class="max-w-7xl mx-auto space-y-8 fade-in">
                    <h1 class="text-3xl font-extrabold text-white border-b border-primary pb-3">æ³•è§„/æ¡ˆä¾‹åº“ç»´æŠ¤ (ç®¡ç†å‘˜)</h1>

                    <!-- å¯¼å…¥ä¸æœç´¢ -->
                    <div class="bg-card p-6 rounded-xl shadow-xl space-y-4 border border-primary">
                        <div class="flex flex-col md:flex-row gap-4">
                            <div class="relative flex-grow">
                                <input type="text" placeholder="æ¨¡ç³Šæœç´¢ï¼ˆå…³é”®è¯ã€æ ‡ç­¾ã€IDï¼‰" class="w-full p-3 pl-10 rounded-xl bg-gray-700 border border-gray-600 focus:border-blue-500 text-white">
                                <svg class="w-5 h-5 absolute top-1/2 transform -translate-y-1/2 left-3 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                            </div>
                            <button class="px-6 py-3 bg-green-600 rounded-xl hover:bg-green-700 transition text-sm whitespace-nowrap font-medium">æ‰¹é‡å¯¼å…¥ (Excel)</button>
                            <button class="px-6 py-3 bg-blue-600 rounded-xl hover:bg-blue-700 transition text-sm whitespace-nowrap font-medium">æ‰‹åŠ¨æ–°å¢</button>
                        </div>
                        <div class="flex flex-wrap gap-2 text-sm text-gray-400 pt-2 border-t border-gray-700">
                            <span class="px-3 py-1 bg-gray-700 rounded-full">æ ‡ç­¾ï¼šå›½å†…æ³•è§„ <button class="ml-1 text-xs text-gray-400 hover:text-white">âœ•</button></span>
                            <span class="px-3 py-1 bg-gray-700 rounded-full">é«˜é£é™©æ¡ˆä¾‹ <button class="ml-1 text-xs text-gray-400 hover:text-white">âœ•</button></span>
                            <span class="text-gray-500 italic text-xs self-center">å·²åŒ¹é…å…³é”®è¯é«˜äº®</span>
                        </div>
                    </div>
                    
                    <!-- æ•°æ®åˆ—è¡¨ (Mock) -->
                    <div class="overflow-x-auto bg-card rounded-xl shadow-xl border border-primary">
                        <table class="min-w-full divide-y divide-gray-700">
                            <thead class="bg-gray-700">
                                <tr>
                                    <th class="p-4 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">ID</th>
                                    <th class="p-4 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">ç±»å‹/æ ‡é¢˜</th>
                                    <th class="p-4 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">åˆ†ç±»æ ‡ç­¾</th>
                                    <th class="p-4 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">æ›´æ–°æ—¶é—´</th>
                                    <th class="p-4 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-700">
                                <tr class="hover:bg-gray-700 transition">
                                    <td class="p-4 text-sm text-blue-400">L001</td>
                                    <td class="p-4 text-sm">æ³•è§„ï¼šä¸ªäººä¿¡æ¯ä¿æŠ¤æ³•</td>
                                    <td class="p-4 text-sm">å›½å†…/æ ¸å¿ƒ</td>
                                    <td class="p-4 text-sm">2025-10-01</td>
                                    <td class="p-4 text-sm space-x-2">
                                        <button class="text-yellow-400 hover:text-yellow-300">ç¼–è¾‘</button>
                                        <button class="text-red-400 hover:text-red-300">åˆ é™¤</button>
                                    </td>
                                </tr>
                                <tr class="hover:bg-gray-700 transition">
                                    <td class="p-4 text-sm text-blue-400">C005</td>
                                    <td class="p-4 text-sm">æ¡ˆä¾‹ï¼šæŸAPPå¼ºåˆ¶æˆæƒæ¡ˆ</td>
                                    <td class="p-4 text-sm">é«˜é£é™©/å›½å†…</td>
                                    <td class="p-4 text-sm">2025-11-10</td>
                                    <td class="p-4 text-sm space-x-2">
                                        <button class="text-yellow-400 hover:text-yellow-300">ç¼–è¾‘</button>
                                        <button class="text-red-400 hover:text-red-300">åˆ é™¤</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            return html;
        }

        /**
         * æ¸²æŸ“ç³»ç»Ÿè¾…åŠ©é¡µé¢ï¼šæ“ä½œæ—¥å¿—é¡µ (Page VII)
         */
        function renderLogsPage() {
            // æ¨¡æ‹Ÿæ•°æ®
            const logs = [
                { id: 1, user: 'Admin', type: 'æ•°æ®å¯¼å…¥', obj: 'æ³•è§„åº“', time: '2025-11-16 11:00', result: 'æˆåŠŸ' },
                { id: 2, user: 'UserA', type: 'æäº¤æ£€æµ‹', obj: 'å¾®èŠ V3.2.1', time: '2025-11-16 10:30', result: 'æˆåŠŸ' },
                { id: 3, user: 'UserA', type: 'æŠ¥å‘Šä¸‹è½½', obj: '1001', time: '2025-11-16 10:40', result: 'æˆåŠŸ' },
                { id: 4, user: 'UserB', type: 'å¿˜è®°å¯†ç ', obj: 'UserB', time: '2025-11-15 15:00', result: 'å¤±è´¥' },
            ];

            const tableRowsHtml = logs.map(l => `
                <tr class="border-b border-gray-700 hover:bg-gray-700 transition duration-150 cursor-pointer">
                    <td class="p-4 text-sm text-blue-400">${l.user}</td>
                    <td class="p-4 text-sm">${l.type}</td>
                    <td class="p-4 text-sm">${l.obj}</td>
                    <td class="p-4 text-sm">${l.time}</td>
                    <td class="p-4 text-sm">
                        <span class="px-3 py-1 text-xs font-semibold rounded-full ${l.result === 'æˆåŠŸ' ? 'bg-green-900 text-green-300' : 'bg-red-900 text-red-300'}">
                            ${l.result}
                        </span>
                    </td>
                    <td class="p-4 text-sm">
                        <button class="text-blue-400 hover:text-blue-300">è¯¦æƒ…/å±•å¼€</button>
                    </td>
                </tr>
            `).join('');

            const html = `
                <div class="max-w-7xl mx-auto space-y-8 fade-in">
                    <h1 class="text-3xl font-extrabold text-white border-b border-primary pb-3">æ“ä½œæ—¥å¿—</h1>

                    <!-- ç­›é€‰ä¸æ§åˆ¶åŒº -->
                    <div class="bg-card p-4 rounded-xl shadow-xl space-y-4 border border-primary">
                        <div class="flex flex-wrap gap-3">
                            <input type="text" placeholder="ç­›é€‰ï¼šæ“ä½œäºº" class="p-2 rounded-xl bg-gray-700 border border-gray-600 text-sm">
                            <select class="p-2 rounded-xl bg-gray-700 border border-gray-600 text-sm">
                                <option>ç­›é€‰ï¼šæ“ä½œç±»å‹</option>
                            </select>
                            <select class="p-2 rounded-xl bg-gray-700 border border-gray-600 text-sm">
                                <option>ç­›é€‰ï¼šç»“æœ</option>
                            </select>
                            <input type="date" class="p-2 rounded-xl bg-gray-700 border border-gray-600 text-sm text-gray-300">
                        </div>
                        <div class="flex justify-end gap-3 pt-2 border-t border-gray-700">
                            <button class="px-4 py-2 text-sm bg-red-600 rounded-xl hover:bg-red-700 transition font-medium">æ‰¹é‡åˆ é™¤æ—¥å¿—</button>
                            <button class="px-4 py-2 text-sm bg-indigo-600 rounded-xl hover:bg-indigo-700 transition font-medium">æ—¥å¿—å¯¼å‡º (Excel)</button>
                        </div>
                    </div>

                    <!-- æ—¥å¿—è¡¨æ ¼ -->
                    <div class="overflow-x-auto bg-card rounded-xl shadow-xl border border-primary">
                        <table class="min-w-full divide-y divide-gray-700">
                            <thead class="bg-gray-700">
                                <tr>
                                    <th class="p-4 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">æ“ä½œäºº</th>
                                    <th class="p-4 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">ç±»å‹</th>
                                    <th class="p-4 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">å¯¹è±¡</th>
                                    <th class="p-4 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">æ—¶é—´</th>
                                    <th class="p-4 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">ç»“æœ</th>
                                    <th class="p-4 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-700">
                                ${tableRowsHtml}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            return html;
        }

        // --- SPA æ ¸å¿ƒé€»è¾‘ ---

        const pageRenderers = {
            'login': renderLoginPage,
            'upload': renderUploadPage,
            'report-list': renderReportListPage,
            'report-detail': renderReportDetailPage,
            'admin': renderAdminPage,
            'logs': renderLogsPage
        };

        /**
         * åˆ‡æ¢é¡µé¢è§†å›¾
         * @param {string} pageName ç›®æ ‡é¡µé¢åç§°
         */
        function renderPage(pageName) {
            // æƒé™æ£€æŸ¥ï¼šéç™»å½•çŠ¶æ€åªèƒ½çœ‹ç™»å½•é¡µ
            if (!isUserLoggedIn && pageName !== 'login') {
                pageName = 'login';
            }
            
            // æƒé™æ£€æŸ¥ï¼šéç®¡ç†å‘˜ä¸èƒ½çœ‹ Admin é¡µ
            if (pageName === 'admin' && !isUserAdmin) {
                 pageName = 'upload'; // é»˜è®¤è·³è½¬åˆ°ä¸Šä¼ é¡µ
            }

            currentPage = pageName;
            
            // æ¸²æŸ“ä¸»å†…å®¹
            mainContentEl.innerHTML = pageRenderers[pageName]();
            
            // åˆ‡æ¢å¯¼èˆªæ æ¿€æ´»çŠ¶æ€
            document.querySelectorAll('.nav-item').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-page') === pageName) {
                    btn.classList.add('active');
                }
            });
            
            // å…³é—­ç§»åŠ¨ç«¯ä¾§è¾¹æ 
            sidebarEl.classList.remove('open');
            sidebarOverlayEl.classList.add('hidden');
        }

        // ç›‘å¬ä¾§è¾¹å¯¼èˆªæ ç‚¹å‡»äº‹ä»¶
        sidebarEl.addEventListener('click', (event) => {
            const button = event.target.closest('.nav-item');
            if (button && !button.disabled) {
                const targetPage = button.getAttribute('data-page');
                if (targetPage === 'login') {
                    // å¦‚æœå·²ç™»å½•ï¼Œç‚¹å‡»ç™»å½•æŒ‰é’®æ‰§è¡Œé€€å‡ºæ“ä½œ
                    if (isUserLoggedIn) {
                        toggleAuth();
                    } else {
                         renderPage('login');
                    }
                } else {
                    renderPage(targetPage);
                }
            }
        });

        // åˆå§‹åŠ è½½ï¼šé»˜è®¤æ¸²æŸ“ç™»å½•é¡µ
        window.onload = () => {
            renderPage('login');
        };

    </script>
</body>
</html>